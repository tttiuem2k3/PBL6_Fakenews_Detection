# import google.generativeai as genai # type: ignore
# import os

# # Mã API key
# API_KEY = "AIzaSyBBfXCGlEU1kuc2lxN0cex9IY6hV1vdvoU"

# # Gắn biến môi trường là mã API key
# os.environ['API_KEY'] = API_KEY

# # Cấu hình API Gemini thông qua biến môi trường
# genai.configure(api_key=os.environ['API_KEY'])
# model = genai.GenerativeModel("gemini-1.5-flash")
# tieude='Hiệp định Geneva là đỉnh cao thắng lợi của ngoại giao Việt Nam'
# noidung= 'Phát biểu tại hội thảo, Chủ tịch Hội đồng Lý luận T.Ư, Giám đốc Học viện Chính trị quốc gia Hồ Chí Minh Nguyễn Xuân Thắng nêu rõ ngày 8.5.1954, Hội nghị Geneva về chấm dứt chiến tranh ở Đông Dương đã được khai mạc. Hội nghị diễn ra chỉ 1 ngày sau chiến thắng lịch sử Điện Biên Phủ "lừng lẫy năm châu, chấn động địa cầu". Đây là lần đầu tiên nền ngoại giao non trẻ của VN tham gia một hội nghị quốc tế đa phương, có đại diện của 5 nước lớn là: Liên Xô, Trung Quốc, Pháp, Anh và Mỹ.Ông Nguyễn Xuân Thắng, Chủ tịch Hội đồng Lý luận T.Ư, Giám đốc Học viện Chính trị quốc gia Hồ Chí Minh và Bộ trưởng Bộ Ngoại giao Bùi Thanh Sơn cùng đại biểu tham quan trưng bày ảnh tại hội thảoThảo PhạmÔng Thắng nhấn mạnh trong bối cảnh quốc tế phức tạp, đoàn VN đã tỏ rõ bản lĩnh, kiên định lập trường độc lập dân tộc, đồng thời khéo léo đàm phán, giải quyết các vấn đề khó khăn như phân vùng đóng quân, tổng tuyển cử và thống nhất VN, cùng các lực lượng kháng chiến ở Lào và Campuchia.Trải qua 75 ngày thương lượng với 31 phiên họp, cùng với nhiều cuộc gặp gỡ, tiếp xúc song phương và đa phương bên lề hội nghị, rạng sáng 21.7.1954, ba Hiệp định đình chỉ chiến sự ở VN, Lào và Campuchia lần lượt được ký kết. Hội nghị đã họp phiên bế mạc và thông qua "Tuyên bố cuối cùng" về Hiệp định lập lại hòa bình ở Đông Dương. Từ đây đã mở ra một cục diện mới, buộc Pháp phải rút quân về nước, chấm dứt hoàn toàn cuộc chiến tranh xâm lược của thực dân Pháp ở Đông Dương, mở ra giai đoạn sụp đổ của chủ nghĩa thực dân kiểu cũ.Theo ông Thắng, Hiệp định Geneva là đỉnh cao thắng lợi của nền ngoại giao VN, khẳng định tính chính nghĩa của cuộc đấu tranh giải phóng dân tộc và tinh thần yêu chuộng hòa bình của nhân dân VN. "Chiến thắng lịch sử Điện Biên Phủ và thắng lợi trên bàn đàm phán tại Hội nghị Geneva là chiến thắng của sức mạnh vĩ đại của nhân dân và khối đại đoàn kết toàn dân tộc VN, với sự đồng tình, ủng hộ và giúp đỡ của bạn bè quốc tế, trong đó có cả nhân dân tiến bộ Pháp và các nước thuộc địa", ông Nguyễn Xuân Thắng nhấn mạnh.Theo ông Nguyễn Xuân Thắng, 70 năm đã trôi qua nhưng ý nghĩa lịch sử của Hiệp định Geneva về đình chỉ chiến sự ở VN vẫn còn vẹn nguyên giá trị, với những bài học kinh nghiệm hết sức quý báu. Đó là bài học giữ vững sự lãnh đạo của Đảng, thành công của đoàn đàm phán VN là kết quả của đường lối cách mạng và ngoại giao đúng đắn dưới sự lãnh đạo của T.Ư Đảng và Chủ tịch Hồ Chí Minh.Bài học về phát huy sức mạnh tổng hợp, Hiệp định Geneva là thành quả của cuộc đấu tranh bền bỉ trên chiến trường và ngoại giao, kết hợp chặt chẽ giữa các mặt trận chính trị, quân sự và ngoại giao. Bài học về giữ vững độc lập, tự chủ, với tư thế người chiến thắng, phái đoàn VN đã nêu cao tinh thần đoàn kết quốc tế, kiên quyết giữ vững lập trường độc lập, tự chủ trong đàm phán.Quán triệt phương châm "dĩ bất biến, ứng vạn biến", với nguyên tắc bất biến là giữ vững độc lập, tự chủ; ứng vạn biến là mềm dẻo, linh hoạt để giành thắng lợi từng bước, từng bộ phận.Bài học về phát huy sức mạnh của nhân dân và khối đại đoàn kết toàn dân tộc, ông Thắng khẳng định chiến thắng là kết quả của sức mạnh vĩ đại của nhân dân và khối đại đoàn kết toàn dân tộc VN, với sự ủng hộ của bạn bè quốc tế.Chủ tịch Hội đồng Lý luận T.Ư khẳng định 70 năm đã qua nhưng ý nghĩa của Hiệp định Geneva vẫn còn nguyên giá trị, phản ánh những nguyên tắc, phương châm, nghệ thuật đối ngoại và sự trưởng thành của nền ngoại giao VN.Tại hội thảo, Bộ trưởng Bộ Ngoại giao Bùi Thanh Sơn khẳng định quá trình đàm phán, ký kết, thực thi Hiệp định Geneva là cuốn cẩm nang chứa đựng nhiều bài học quý giá về đối ngoại. Thể hiện bản sắc độc đáo của trường phái đối ngoại và ngoại giao VN, đã được kế thừa, vận dụng sáng tạo và phát triển trong đàm phán, ký kết, thực thi Hiệp định Paris 1973 sau này, cũng như trong xây dựng, phát triển đất nước và bảo vệ Tổ quốc hiện nay.Trong lịch sử dựng nước và giữ nước của dân tộc, cha ông ta luôn kết hợp khéo léo giữa "đánh" và "đàm", giữa giành thắng lợi mang tính chiến lược trên chiến trường với giải pháp ngoại giao để bảo vệ nền độc lập, lập lại hòa bình. Theo Bộ trưởng Bộ Ngoại giao, chiến dịch Điện Biên Phủ và Hội nghị Geneva là một sự kết hợp mẫu mực và điển hình như vậy. Sự phối hợp chặt chẽ giữa mặt trận ngoại giao với mặt trận chính trị và quân sự, dưới sự lãnh đạo, chỉ đạo tài tình của Đảng, Chủ tịch Hồ Chí Minh, đã chuyển hóa những thắng lợi trên chiến trường thành thắng lợi về chính trị, pháp lý, đối ngoại.Bộ trưởng nhấn mạnh, việc đúc kết các bài học lịch sử từ quá trình đàm phán, ký kết, thực thi Hiệp định Geneva 1954 có ý nghĩa rất thiết thực, góp phần phục vụ nghiên cứu, xây dựng và hoàn thiện cơ sở lý luận, phương pháp luận cho đối ngoại và ngoại giao thời đại Hồ Chí Minh cũng như xây dựng, hoàn thiện và triển khai đường lối đối ngoại của Đảng trong các giai đoạn phát triển mới của đất nước.'
# text = f"Sinh ra nội dung tin giả (câu trả lời phải có số từ bằng nội dung tin thật, phải ở dạng:FakeTitle: abc FakeContent: xyz) dựa trên tiêu đề và nội dung sau:\n\nTiêu đề: {tieude}\nNội dung: {noidung}"
# response = model.generate_content(text)
# print(response.text)
#--------------------------------------------------------------------------------------
import pandas as pd
import google.generativeai as genai
import os

# Cấu hình API của Google Gemini
API_KEY = "AIzaSyAWGyiV5xFhKJ36snDdV-rkHHwvSGxVhuw"
def call_model(API_KEY):
    os.environ['API_KEY'] = API_KEY 
    genai.configure(api_key=os.environ['API_KEY'])
    model = genai.GenerativeModel("gemini-1.5-flash")

# Đọc dữ liệu từ file news.csv
news_df = pd.read_csv('News.csv')

# Kiểm tra nếu fakenews.csv đã tồn tại
fake_news_file = 'fakenews.csv'
if os.path.exists(fake_news_file):
    # Đọc dữ liệu từ file fakenews.csv
    fake_news_df_existing = pd.read_csv(fake_news_file)
    existing_sources = set(fake_news_df_existing['Source'].values)  # Lấy danh sách các nguồn đã tồn tại
else:
    # Tạo DataFrame rỗng nếu file chưa tồn tại
    fake_news_df_existing = pd.DataFrame(columns=['Title', 'Content', 'Source', 'Label', 'DateTime'])
    existing_sources = set()

# Danh sách để lưu dữ liệu tin giả mới
fake_news_data = []

# Sinh tin giả cho mỗi bài viết\
i=1
for index, row in news_df.iterrows():
    # Lấy tiêu đề và nội dung gốc
    original_title = str(row['Title'])
    original_content = str(row['Content'])
    article_source = row['Source']
    
    # Kiểm tra xem bài viết đã tồn tại trong fakenews.csv chưa (dựa trên Source)
    if article_source in existing_sources:
        # print(f"Bài viết với Source {article_source} đã tồn tại, bỏ qua.")
        print("Tin thứ "+str(i)+ " chạy bị trùng lặp!!!<-> "+original_title[0:40]+" <-> "+original_content[0:40])
        i=i+1
        continue  # Bỏ qua nếu bài viết đã tồn tại
    
    # Chuỗi yêu cầu sinh tin giả
    prompt = f"Sinh ra nội dung tin giả (câu trả lời phải có số từ bằng hoặc nhiều hơn nội dung tin thật, phải bỏ đi các chú thích dư thừa và phải ở dạng:FakeTitle: abc FakeContent: xyz) dựa trên tiêu đề và nội dung sau:\n\nTiêu đề: {original_title}\n\nNội dung: {original_content}"
    
    # Gọi API của Google Gemini để sinh nội dung tin giả
    k=0
    while k==0:
        try:
            response = model.generate_content(prompt)
            fake_content = response.text
            title_start = fake_content.find("FakeTitle:") + len("FakeTitle:")
            content_start = fake_content.find("FakeContent:") + len("FakeContent:")
            # Lấy phần FakeTitle và FakeContent
            fake_title = fake_content[title_start:content_start - len("FakeContent:")].strip()
            fake_content = fake_content[content_start:].strip()
            
            # print("Tin thứ "+str(i)+ " <->  Title: "+original_title+"\nContent: "+original_content)
            # print("->->->->->->->->->->->->->->->->->->->->->->->->->->->->->->->->->->->->->->")
            # print("Tin thứ "+str(i)+ " đã chạy ->  Fake_Title: "+fake_title+"\n->Fake_Content: "+fake_content)
            # print("-----------------------------------------------------------------------------")
                
            print("Tin thứ "+str(i)+ " đã chạy <-> "+fake_title[0:40]+"... <-> "+fake_content[0:40]+"...")
            # Lưu dữ liệu đã sinh vào danh sách
            fake_news_data.append({
                'Title': fake_title,  # Sử dụng tiêu đề gốc để dễ theo dõi
                'Content': fake_content,
                'Source': article_source,
                'Label':  'Fake',
                'DateTime': row['DateTime']
            })
            k=1
                    # Chỉ ghi dữ liệu nếu có bài viết mới
            if fake_news_data:
                # Tạo DataFrame mới cho dữ liệu tin giả mới
                fake_news_df_new = pd.DataFrame(fake_news_data)
                
                # Kết hợp dữ liệu cũ và mới (nếu file đã tồn tại)
                fake_news_df_combined = pd.concat([fake_news_df_existing, fake_news_df_new], ignore_index=True)
                
                # Lưu dữ liệu kết hợp vào file fakenews.csv
                fake_news_df_combined.to_csv(fake_news_file, index=False, encoding='utf-8')
                
                # print("Dữ liệu tin giả mới đã được lưu vào fakenews.csv")
            else:
                print("Không có dữ liệu tin giả mới để lưu.")
        except Exception as e:
            k=0
            print(f"Lỗi sinh tin giả: "+"tin thứ "+str(i)+" chạy lại!")
    i=i+1
